var ee=Object.defineProperty;var te=(e,c,n)=>c in e?ee(e,c,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[c]=n;var C=(e,c,n)=>(te(e,typeof c!="symbol"?c+"":c,n),n);import{O as ae,D as le,F as oe,I as ne,P as re,f as se,Q as ce,R as ie,S as ue}from"./element-plus.0e1471b6.js";import{i as de}from"./is.84ee87a3.js";import{l as Z,r as m,w as G,e as O,j as me,T as pe,c as $,Z as F,S as f,P as N,u as x,o as D,F as T,a9 as H,R as z,L as ge,V as j,am as I,W as X,a2 as J,a5 as fe,d as ve,a as he,X as q,Y}from"./@vue.ae71f803.js";import{c as k,h as M,u as _e}from"./index.a782ff1d.js";import{u as W}from"./vue-i18n.cb61a333.js";const ye=Z({__name:"CForm",props:{options:{default:()=>[]},gutter:{default:24},colSpan:null,value:{default:{}},loading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(e,{expose:c,emit:n}){const r=e,p={input:"el-input",select:"el-select",inputNumber:"el-input-number",timePicker:"el-time-picker",datePicker:"el-date-picker",richText:"WangEditor"},E=["el-input","el-input-number","async-select"],i=m(),V=m({}),S=m([]),d=m({}),y=a=>a.map(l=>{let{name:w,type:v,tagName:h,..._}=l;return p[v]&&!h&&(h=p[v]),{..._,name:w,tagName:h}});G(()=>r.options,a=>{const l={};S.value=a.map(w=>{let{name:v,type:h,children:_,rules:t,tagName:g,...o}=w;return t&&(l[v]=t),h&&p[h]&&!g&&(g=p[h]),_&&de(_)&&(_=y(_)),{...o,name:v,tagName:g,children:_}}),V.value=l},{immediate:!0});const b=O(()=>{const a=r.options&&r.options.length>10?{md:12,xs:24}:{span:24};return r.colSpan||a});async function U(){var a;await((a=i.value)==null?void 0:a.validate(l=>{if(l){const w=r.value;n("submit",w)}}))}function A(...a){var l;(l=i.value)==null||l.validateField(...a)}function P(...a){var l;(l=i.value)==null||l.validate(...a)}function B(...a){var l;(l=i.value)==null||l.resetFields(...a)}function L(...a){var l;(l=i.value)==null||l.clearValidate(...a)}return c({validateField:A,validate:P,resetFields:B,clearValidate:L,submit:U}),G(()=>r.value,a=>{d.value=a},{immediate:!0}),me(()=>{n("update:value",d.value)}),(a,l)=>{const w=ae,v=le,h=oe,_=ne;return pe((D(),$("div",null,[F(x(re),N({ref_key:"formRef",ref:i,rules:V.value,model:e.value},a.$attrs),{default:f(()=>[F(h,{gutter:e.gutter},{default:f(()=>[(D(!0),$(T,null,H(S.value,(t,g)=>(D(),$(T,{key:g},[t.hidden?X("",!0):(D(),z(v,N({key:0},t.colSpan||x(b),{key:t.name}),{default:f(()=>[F(w,N({prop:t.name,label:t.label},t.itemExtra),{default:f(()=>{var o,u,R;return[t.scopedSlot&&a.$slots[t.scopedSlot]?ge(a.$slots,t.scopedSlot,{key:0,value:e.value,option:t}):t.tagName?(D(),$(T,{key:1},[E.includes(t.tagName)?(D(),z(j(t.tagName),N({key:0,modelValue:d.value[t.name],"onUpdate:modelValue":s=>d.value[t.name]=s,modelModifiers:{trim:!0}},t.props,I((o=t.on)!=null?o:{})),null,16,["modelValue","onUpdate:modelValue"])):t.children?(D(),z(j(t.tagName),N({key:1,modelValue:d.value[t.name],"onUpdate:modelValue":s=>d.value[t.name]=s,modelModifiers:{trim:!0}},t.props,I((u=t.on)!=null?u:{})),{default:f(()=>[(D(!0),$(T,null,H(t.children,(s,K)=>{var Q;return D(),z(j(s.tagName),N({key:K},s.props,I((Q=s.on)!=null?Q:{})),null,16)}),128))]),_:2},1040,["modelValue","onUpdate:modelValue"])):(D(),z(j(t.tagName),N({key:2,modelValue:d.value[t.name],"onUpdate:modelValue":s=>d.value[t.name]=s},t.props,I((R=t.on)!=null?R:{})),null,16,["modelValue","onUpdate:modelValue"]))],64)):X("",!0)]}),_:2},1040,["prop","label"])]),_:2},1040))],64))),128))]),_:3},8,["gutter"])]),_:3},16,["rules","model"])])),[[_,e.loading]])}}});class be{constructor(c){C(this,"dataSource",m([]));C(this,"loading",m(!1));C(this,"ids",m([]));C(this,"queryParam",m());C(this,"url",m({}));C(this,"modalFormRef",m());C(this,"drawerFormRef",m());C(this,"ipagination",J({current:1,total:0,pageSize:10,pageSizeOptions:[5,10,20,50,100]}));this.url.value=c}}function we(e){const c=new be(e),{t:n}=W(),{dataSource:r,ipagination:p,loading:E,queryParam:i,ids:V,modalFormRef:S,drawerFormRef:d}=fe(J(c)),y=()=>({page:p.value.current,pageSize:p.value.pageSize,...i.value}),b=async(o=!1)=>{if(!e.list){k("error",n("page.common.notice.set_url_list"));return}o&&(p.value.current=1);const u=y();try{E.value=!0;const R=await M.get(e.list,u);r.value=R.data,p.value.total=Number(R.total)}finally{E.value=!1}},U=()=>{S.value.edit({}),S.value.title=n("page.common.title.add")},A=o=>{i.value=o,b(!0)},P=()=>{i.value={},b(!0)},B=(o,u=n("page.common.title.edit"))=>{S.value.edit(o),S.value.title=u},L=async o=>new Promise(async(u,R)=>{try{if(!e.add){k("error",n("page.common.notice.set_url_add"));return}const s=await M.post(e.add,{data:o});s.code===200&&s.data.count>0&&u(s)}catch(s){R(s)}}),a=async o=>new Promise(async(u,R)=>{try{if(!e.edit){k("error",n("page.common.notice.set_url_edit"));return}const s=await M.put(e.edit,{data:o});s.code===200&&s.data.count>0&&u(s)}catch(s){R(s)}}),l=async o=>{if(!e.delete){k("error",n("page.common.notice.set_url_delete"));return}const u=await M.delete(`${e.delete}/${o}`);u.code===200&&u.data.count>0&&(k("success",n("page.common.notice.delete_success")),b(!0))},w=async()=>{if(!e.batchDelete){k("error",n("page.common.notice.set_url_batchDelete"));return}if(V.value.length===0){k("error",n("page.common.notice.empty_delete_data"));return}const o=await M.delete(e.batchDelete,{ids:V.value.join(",")});o.code===200&&o.data.count>0&&(k("success",n("page.common.notice.batchDelete_success")),b(!0))},v=()=>{d.value.add(),d.value.title=n("page.common.title.add")},h=(o,u=n("page.common.title.edit"))=>{d.value.edit(o),d.value.title=u},_=o=>{p.value.pageSize=o,b()},t=o=>{p.value.current=o,b()},g=o=>{V.value=x(o).map(u=>u.id)};return ve(async()=>{await b(!0)}),{loadData:b,handleOpenAddDialog:U,handleOpenEditDialog:B,handleReset:P,handleAdd:L,handleEdit:a,handleDelete:l,handleBatchDelete:w,handleSearch:A,handleOpenAddDialogDrawer:v,handleOpenEditDialogDrawer:h,handleSizeChange:_,handleCurrentChange:t,handleSelectionChange:g,dataSource:r,ids:V,ipagination:p,modalFormRef:S,loading:E}}const Ve={list:"/article",delete:"/article",batchDelete:"/article",edit:"/article",add:"/article"},Ne=()=>{const{t:e}=W(),c=O(()=>[{label:e("page.common.design.article.search.title"),name:"title",tagName:"el-input",props:{placeholder:e("page.common.design.article.search.title_placeholder"),maxLength:"24"}},{label:e("page.common.design.article.search.content"),name:"content",tagName:"el-input",props:{placeholder:e("page.common.design.article.search.content_placeholder"),maxLength:"24"}},{label:e("page.common.design.article.search.type"),name:"type",tagName:"async-select",props:{placeholder:e("page.common.design.article.search.type_placeholder"),url:"/article/type",size:"default",style:{width:"100%"}}}]),n=O(()=>[{type:"selection",show:!0,width:"55"},{prop:"id",show:!0,label:e("page.common.design.article.column.id"),width:"80"},{prop:"title",show:!0,label:e("page.common.design.article.column.title"),width:"180"},{prop:"content",show:!0,label:e("page.common.design.article.column.content"),showOverflowTooltip:!0},{prop:"actions",show:!0,label:e("page.common.design.article.column.action"),fixed:"right",scoped:"actions",width:"150"}]);return{articleFilterOptions:c,articleColumns:n}},Se={class:"dialog-footer"},xe=Z({__name:"ArticleEditDialog",emits:["close"],setup(e,{expose:c,emit:n}){const{t:r}=W(),{handleEdit:p,handleAdd:E}=we(Ve),i=m(!1),V=m(),S=m(""),{gtMd:d}=_e(),y=m({}),b=O(()=>y.value.id!==void 0),U=O(()=>d.value?"50%":"80%");function A(a){y.value=Object.assign({},a),i.value=!0}function P(){var a;(a=V.value)==null||a.clearValidate(),i.value=!1}async function B(a){!a||await a.validate(l=>{l&&(b.value?p(y.value).then(()=>{k("success",r("page.common.notice.edit_success")),n("close"),i.value=!1}):E(y.value).then(()=>{k("success",r("page.common.notice.add_success")),n("close"),i.value=!1}))})}const L=O(()=>[{name:"title",type:"input",label:r("page.common.design.article.form.title"),rules:[{required:!0,message:r("page.common.design.article.form.title_placeholder"),trigger:"blur"}],props:{maxLength:50,placeholder:r("page.common.design.article.form.title_placeholder")}},{name:"content",type:"input",label:r("page.common.design.article.form.content"),rules:[{required:!0,message:r("page.common.design.article.form.content_placeholder"),trigger:"blur"}],props:{autosize:{minRows:4,maxRows:8},type:"textarea",placeholder:r("page.common.design.article.form.content_placeholder")}},{name:"type",label:r("page.common.design.article.form.type"),rules:[{required:!0,message:r("page.common.design.article.form.type_placeholder"),trigger:"blur"}],scopedSlot:"type"}]);return c({edit:A,title:S}),(a,l)=>{const w=se,v=ce,h=ie,_=ye,t=ue;return D(),z(t,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=g=>i.value=g),width:x(U),title:S.value,onClose:P},{footer:f(()=>[he("span",Se,[F(w,{onClick:P},{default:f(()=>[q(Y(x(r)("page.common.btn.cancel")),1)]),_:1}),F(w,{type:"primary",onClick:l[0]||(l[0]=g=>B(V.value))},{default:f(()=>[q(Y(x(r)("page.common.btn.confirm")),1)]),_:1})])]),default:f(()=>[F(_,{ref_key:"ruleFormRef",ref:V,value:y.value,"onUpdate:value":l[2]||(l[2]=g=>y.value=g),"label-width":"80px",options:x(L)},{type:f(()=>[F(h,{modelValue:y.value.type,"onUpdate:modelValue":l[1]||(l[1]=g=>y.value.type=g),class:"ml-4"},{default:f(()=>[F(v,{label:"history",size:"large"},{default:f(()=>[q("\u5386\u53F2")]),_:1}),F(v,{label:"literature",size:"large"},{default:f(()=>[q("\u6587\u5B66")]),_:1}),F(v,{label:"technology",size:"large"},{default:f(()=>[q("\u79D1\u6280")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["value","options"])]),_:1},8,["modelValue","width","title"])}}});export{ye as _,Ve as a,xe as b,Ne as s,we as u};
